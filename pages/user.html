<!DOCTYPE html>
<html>
<head>
  <title>User Dashboard</title>
</head>
<body>
  <h1>Welcome, <span id="username"></span></h1>

  <h2>Energy Consumption</h2>
  <pre id="energyConsumption">Loading...</pre>

  <h2>Comparison</h2>
  <pre id="energyComparison">Loading...</pre>

  <h2>Invoice Summary</h2>
  <pre id="invoiceSummary">Loading...</pre>

  <script>
    // Extract username from URL
    const params = new URLSearchParams(window.location.search);
    const username = params.get('username');
    document.getElementById('username').textContent = username;

    // Fetch dashboard data
    fetch(`/api/dashboard?username=${encodeURIComponent(username)}`)
      .then(res => {
        if (!res.ok) throw new Error('Failed to fetch dashboard data');
        return res.json();
      })
      .then(data => {
        document.getElementById('energyConsumption').textContent =
          JSON.stringify(data.energyConsumption, null, 2);
        document.getElementById('energyComparison').textContent =
          JSON.stringify(data.energyComparison, null, 2);
        document.getElementById('invoiceSummary').textContent =
          JSON.stringify(data.invoiceSummary, null, 2);
      })
      .catch(err => {
        console.error(err);
        alert('Failed to load dashboard data.');
      });
  </script>
</body>
</html>
